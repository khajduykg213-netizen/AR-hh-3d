<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>AR Hình học 3D – Trải Net</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- THREE -->
  <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.158.0/examples/js/controls/OrbitControls.js"></script>

  <!-- GSAP animation -->
  <script src="https://unpkg.com/gsap@3.12.2/dist/gsap.min.js"></script>

  <style>
    body { margin: 0; overflow: hidden; font-family: Arial; }
    #ui {
      position: absolute;
      top: 10px; left: 10px;
      background: rgba(255,255,255,0.95);
      padding: 10px;
      border-radius: 8px;
      z-index: 10;
    }
    button {
      width: 200px;
      margin-bottom: 6px;
      padding: 6px;
      cursor: pointer;
    }
  </style>
</head>

<body>

<div id="ui">
  <button onclick="showCylinder()">Hiển thị hình trụ 3D</button>
  <button onclick="unfoldCylinder()">Trải Net có animation</button>
</div>

<script>
/* ================== SCENE ================== */
let scene = new THREE.Scene();
scene.background = new THREE.Color(0xf5f5f5);

let camera = new THREE.PerspectiveCamera(
  60, window.innerWidth/window.innerHeight, 0.01, 100
);
camera.position.set(2, 2, 3);

let renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

let controls = new THREE.OrbitControls(camera, renderer.domElement);

/* ================== LIGHT ================== */
scene.add(new THREE.AmbientLight(0xffffff, 0.7));
let light = new THREE.DirectionalLight(0xffffff, 0.8);
light.position.set(5, 10, 5);
scene.add(light);

/* ================== GLOBAL ================== */
let currentMesh = null;
let currentNet = null;

/* ================== HÌNH TRỤ 3D ================== */
function showCylinder() {
  clearAll();

  const geo = new THREE.CylinderGeometry(0.5, 0.5, 1, 32);
  const mat = new THREE.MeshStandardMaterial({
    color: 0x4fc3f7,
    transparent: true,
    opacity: 0.9
  });

  currentMesh = new THREE.Mesh(geo, mat);
  scene.add(currentMesh);
}

/* ================== TRẢI NET ================== */
function unfoldCylinder() {
  clearAll();

  const radius = 0.5;
  const height = 1;
  const segments = 20;

  const netGroup = new THREE.Group();

  /* ===== MẶT XUNG QUANH ===== */
  const faceWidth = (2 * Math.PI * radius) / segments;

  for (let i = 0; i < segments; i++) {
    const geo = new THREE.PlaneGeometry(faceWidth, height);
    const mat = new THREE.MeshStandardMaterial({
      color: 0x4fc3f7,
      side: THREE.DoubleSide
    });

    const face = new THREE.Mesh(geo, mat);

    // Nằm phẳng
    face.rotation.x = -Math.PI / 2;

    // Xếp ngang
    face.position.x = i * faceWidth - (segments * faceWidth) / 2;
    face.position.y = 0;
    face.position.z = 0;

    // Animation bung mặt
    face.scale.x = 0;
    gsap.to(face.scale, {
      x: 1,
      duration: 0.6,
      delay: i * 0.04,
      ease: "power2.out"
    });

    netGroup.add(face);
  }

  /* ===== ĐÁY DƯỚI ===== */
  const baseGeo = new THREE.CircleGeometry(radius, 40);
  const baseMat = new THREE.MeshStandardMaterial({
    color: 0xffcc80,
    side: THREE.DoubleSide
  });

  const bottom = new THREE.Mesh(baseGeo, baseMat);
  bottom.rotation.x = -Math.PI / 2;
  bottom.position.z = height / 2 + radius;
  netGroup.add(bottom);

  /* ===== ĐÁY TRÊN ===== */
  const top = bottom.clone();
  top.position.z = -height / 2 - radius;
  netGroup.add(top);

  currentNet = netGroup;
  scene.add(netGroup);
}

/* ================== CLEAR ================== */
function clearAll() {
  if (currentMesh) {
    scene.remove(currentMesh);
    currentMesh = null;
  }
  if (currentNet) {
    scene.remove(currentNet);
    currentNet = null;
  }
}

/* ================== RESIZE ================== */
window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});

/* ================== LOOP ================== */
function animate() {
  requestAnimationFrame(animate);
  controls.update();
  renderer.render(scene, camera);
}
animate();
</script>

</body>
</html>
